


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > UserService</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.idatt2105.backend.service</a>
</div>

<h1>Coverage Summary for Class: UserService (com.idatt2105.backend.service)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">UserService</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    12.5%
  </span>
  <span class="absValue">
    (2/16)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    14.9%
  </span>
  <span class="absValue">
    (10/67)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package com.idatt2105.backend.service;
&nbsp;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Collections;
&nbsp;import java.util.HashSet;
&nbsp;import java.util.List;
&nbsp;import java.util.Optional;
&nbsp;import java.util.Set;
&nbsp;
&nbsp;import org.springframework.beans.factory.annotation.Autowired;
&nbsp;import org.springframework.stereotype.Service;
&nbsp;import org.springframework.validation.annotation.Validated;
&nbsp;
&nbsp;import com.idatt2105.backend.dto.QuizDTO;
&nbsp;import com.idatt2105.backend.dto.UserDTO;
&nbsp;import com.idatt2105.backend.model.Quiz;
&nbsp;import com.idatt2105.backend.model.User;
&nbsp;import com.idatt2105.backend.repository.UserRepository;
&nbsp;import com.idatt2105.backend.util.ExistingUserException;
&nbsp;import com.idatt2105.backend.util.InvalidCredentialsException;
&nbsp;import com.idatt2105.backend.util.UserNotFoundException;
&nbsp;
&nbsp;import jakarta.validation.constraints.NotNull;
&nbsp;
&nbsp;/** Service class for User entities. Handles business logic for User entities. */
&nbsp;@Service
&nbsp;public class UserService {
&nbsp;  private final UserRepository userRepository;
&nbsp;
&nbsp;  @Autowired
<b class="fc">&nbsp;  public UserService(UserRepository userRepository) {</b>
<b class="fc">&nbsp;    this.userRepository = userRepository;</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * Gets all registered users.
&nbsp;   *
&nbsp;   * @return List of all registered users.
&nbsp;   */
&nbsp;  public List&lt;UserDTO&gt; getUsers() {
<b class="nc">&nbsp;    List&lt;User&gt; users = userRepository.findAll();</b>
<b class="nc">&nbsp;    List&lt;UserDTO&gt; userDTOs = new ArrayList&lt;&gt;();</b>
&nbsp;
<b class="nc">&nbsp;    for (User user : users) {</b>
<b class="nc">&nbsp;      List&lt;QuizDTO&gt; quizDTOs = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;      for (Quiz quiz : user.getQuizzes()) {</b>
<b class="nc">&nbsp;        quizDTOs.add(new QuizDTO(quiz));</b>
<b class="nc">&nbsp;      }</b>
<b class="nc">&nbsp;      userDTOs.add(new UserDTO(user.getId(), user.getUsername(), quizDTOs));</b>
<b class="nc">&nbsp;    }</b>
<b class="nc">&nbsp;    return userDTOs;</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * Gets a user by a unique id.
&nbsp;   *
&nbsp;   * @param id (Long) Unique id of the user.
&nbsp;   * @return Optional of the user with the given id.
&nbsp;   * @throws UserNotFoundException If no user with the given id is found.
&nbsp;   */
&nbsp;  public Optional&lt;UserDTO&gt; getUserById(Long id) {
<b class="nc">&nbsp;    return userRepository</b>
<b class="nc">&nbsp;        .findById(id)</b>
<b class="nc">&nbsp;        .map(</b>
&nbsp;            user -&gt; {
<b class="nc">&nbsp;              List&lt;QuizDTO&gt; quizDTOs = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;              for (Quiz quiz : user.getQuizzes()) {</b>
<b class="nc">&nbsp;                quizDTOs.add(new QuizDTO(quiz));</b>
<b class="nc">&nbsp;              }</b>
<b class="nc">&nbsp;              return new UserDTO(user.getId(), user.getUsername(), quizDTOs);</b>
&nbsp;            })
<b class="nc">&nbsp;        .or(() -&gt; Optional.&lt;UserDTO&gt;empty());</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * Adds a new user to the database.
&nbsp;   *
&nbsp;   * @param user (User) User to add.
&nbsp;   * @return The added user.
&nbsp;   * @throws ExistingUserException If a user with the same username already exists.
&nbsp;   */
&nbsp;  public UserDTO addUser(@Validated @NotNull User user) {
<b class="nc">&nbsp;    if (userExists(user.getUsername())) {</b>
<b class="nc">&nbsp;      throw new ExistingUserException(</b>
<b class="nc">&nbsp;          &quot;User with username &quot; + user.getUsername() + &quot; already exists&quot;);</b>
&nbsp;    }
<b class="nc">&nbsp;    User savedUser = userRepository.save(user);</b>
<b class="nc">&nbsp;    return new UserDTO(savedUser.getId(), savedUser.getUsername(), Collections.emptyList());</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * Deletes a user from the database.
&nbsp;   *
&nbsp;   * @param id (Long) Id of the user to delete.
&nbsp;   * @throws UserNotFoundException If no user with the given id is found.
&nbsp;   */
&nbsp;  public void deleteUser(Long id) {
<b class="nc">&nbsp;    if (!userRepository.existsById(id)) {</b>
<b class="nc">&nbsp;      throw new UserNotFoundException(&quot;User with id &quot; + id + &quot; not found&quot;);</b>
&nbsp;    }
<b class="nc">&nbsp;    userRepository.deleteById(id);</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * Updates a user in the database.
&nbsp;   *
&nbsp;   * @param id (Long) Id of the user to update.
&nbsp;   * @param user (User) User with updated information.
&nbsp;   * @return The updated user.
&nbsp;   * @throws UserNotFoundException If no user with the given id is found.
&nbsp;   */
&nbsp;  public UserDTO updateUser(Long id, @Validated @NotNull User user) {
<b class="nc">&nbsp;    User existingUser =</b>
&nbsp;        userRepository
<b class="nc">&nbsp;            .findById(id)</b>
<b class="nc">&nbsp;            .orElseThrow(() -&gt; new UserNotFoundException(&quot;User with id &quot; + id + &quot; not found&quot;));</b>
<b class="nc">&nbsp;    existingUser.setUsername(user.getUsername());</b>
<b class="nc">&nbsp;    existingUser.setPassword(user.getPassword());</b>
<b class="nc">&nbsp;    User updatedUser = userRepository.save(existingUser);</b>
<b class="nc">&nbsp;    List&lt;QuizDTO&gt; quizDTOs = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;    for (Quiz quiz : updatedUser.getQuizzes()) {</b>
<b class="nc">&nbsp;      quizDTOs.add(new QuizDTO(quiz));</b>
<b class="nc">&nbsp;    }</b>
<b class="nc">&nbsp;    return new UserDTO(updatedUser.getId(), updatedUser.getUsername(), quizDTOs);</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * Gets a user by username.
&nbsp;   *
&nbsp;   * @param username (String) Username of the user.
&nbsp;   * @return User with the given username.
&nbsp;   * @throws UserNotFoundException If no user with the given username is found.
&nbsp;   */
&nbsp;  public Optional&lt;UserDTO&gt; getUserByUsername(String username) {
<b class="nc">&nbsp;    return userRepository</b>
<b class="nc">&nbsp;        .findByUsername(username)</b>
<b class="nc">&nbsp;        .map(</b>
&nbsp;            user -&gt; {
<b class="nc">&nbsp;              return new UserDTO(user.getId(), user.getUsername());</b>
&nbsp;            });
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * Checks if a user with the given username exists.
&nbsp;   *
&nbsp;   * @param username (String) Username to check.
&nbsp;   * @return True if a user with the given username exists, false otherwise.
&nbsp;   */
&nbsp;  public boolean userExists(String username) {
<b class="nc">&nbsp;    return userRepository.findByUsername(username).isPresent();</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * Logs a user in.
&nbsp;   *
&nbsp;   * @param user (User) The user to log in.
&nbsp;   * @return A token for future authentication.
&nbsp;   */
&nbsp;  public String login(@Validated @NotNull User user) {
<b class="nc">&nbsp;    if (validateCredentials(user)) {</b>
<b class="nc">&nbsp;      return &quot;Token&quot;;</b>
&nbsp;    } else {
<b class="nc">&nbsp;      throw new InvalidCredentialsException(&quot;Invalid user credentials.&quot;);</b>
&nbsp;    }
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * Checks the credentials of the given user.
&nbsp;   *
&nbsp;   * @param user (User) The user to be validated.
&nbsp;   * @return {@code true} if the credentials are valid, {@code false} otherwise.
&nbsp;   * @throws UserNotFoundException If no user with the given username is found.
&nbsp;   */
&nbsp;  private boolean validateCredentials(@Validated @NotNull User user) {
<b class="nc">&nbsp;    User existingUser =</b>
&nbsp;        userRepository
<b class="nc">&nbsp;            .findByUsername(user.getUsername())</b>
<b class="nc">&nbsp;            .orElseThrow(</b>
&nbsp;                () -&gt;
<b class="nc">&nbsp;                    new UserNotFoundException(</b>
<b class="nc">&nbsp;                        &quot;User with username &quot; + user.getUsername() + &quot; not found&quot;));</b>
<b class="nc">&nbsp;    return existingUser.getPassword().equals(user.getPassword());</b>
&nbsp;  }
&nbsp;
&nbsp;  /*
&nbsp;   * Gets all quizzes created by a user.
&nbsp;   * @param userId (Long) Id of the user.
&nbsp;   * @return Set of quizzes created by the user.
&nbsp;   */
&nbsp;  public Set&lt;QuizDTO&gt; getQuizzesByUserId(Long userId) {
<b class="fc">&nbsp;    User user =</b>
&nbsp;        userRepository
<b class="fc">&nbsp;            .findById(userId)</b>
<b class="fc">&nbsp;            .orElseThrow(() -&gt; new IllegalStateException(&quot;User with id &quot; + userId + &quot; not found&quot;));</b>
<b class="fc">&nbsp;    Set&lt;QuizDTO&gt; quizDTOs = new HashSet&lt;&gt;();</b>
<b class="fc">&nbsp;    for (Quiz quiz : user.getQuizzes()) {</b>
<b class="fc">&nbsp;      quizDTOs.add(new QuizDTO(quiz));</b>
<b class="fc">&nbsp;    }</b>
<b class="fc">&nbsp;    return quizDTOs;</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * Saves a user to the database.
&nbsp;   *
&nbsp;   * @param user (User) User to save.
&nbsp;   * @return The saved user.
&nbsp;   */
&nbsp;  public UserDTO save(User user) {
<b class="nc">&nbsp;    User savedUser = userRepository.save(user);</b>
<b class="nc">&nbsp;    return new UserDTO(savedUser.getId(), savedUser.getUsername(), Collections.emptyList());</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * Gets a user by id.
&nbsp;   *
&nbsp;   * @param id (Long) Id of the user to get.
&nbsp;   * @return Optional of the user with the given id.
&nbsp;   */
&nbsp;  public Optional&lt;UserDTO&gt; getUserByIdDTO(Long id) {
<b class="nc">&nbsp;    return userRepository</b>
<b class="nc">&nbsp;        .findById(id)</b>
<b class="nc">&nbsp;        .map(user -&gt; new UserDTO(user.getId(), user.getUsername(), Collections.emptyList()));</b>
&nbsp;  }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-03-25 15:30</div>
</div>
</body>
</html>
